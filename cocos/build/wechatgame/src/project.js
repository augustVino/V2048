window.__require=function o(t,e,c){function n(i,s){if(!e[i]){if(!t[i]){var r=i.split("/");if(r=r[r.length-1],!t[r]){var l="function"==typeof __require&&__require;if(!s&&l)return l(r,!0);if(a)return a(r,!0);throw new Error("Cannot find module '"+i+"'")}}var u=e[i]={exports:{}};t[i][0].call(u.exports,function(o){return n(t[i][1][o]||o)},u,u.exports,o,t,e,c)}return e[i].exports}for(var a="function"==typeof __require&&__require,i=0;i<c.length;i++)n(c[i]);return n}({GlobalData:[function(o,t,e){"use strict";cc._RF.push(t,"e7066A/c2VBzJ2dF6w4TXof","GlobalData"),window.G={userInfo:null},cc._RF.pop()},{}],GlobalWeChat:[function(o,t,e){"use strict";cc._RF.push(t,"18822anBQVHYaJ1EgFg/Gll","GlobalWeChat"),window.WeChat={},WeChat.onRegisterUser=function(o){wx.cloud.callFunction({name:"login",data:{userinfo:o},success:function(o){console.log("\u767b\u5f55\u6210\u529f\u56de\u8c03",o),G.userInfo=o.result.data.length>0?o.result.data[0].userinfo:o.result.data.userinfo,G.userInfo.openId=o.result.data.length>0?o.result.data[0].openid:o.result.data.openid,cc.director.loadScene("game")},fail:function(o){console.error(o)}})},WeChat.onUpdateScore=function(o){wx.cloud.callFunction({name:"score",data:{_type:"update",score:o,userinfo:G.userInfo},success:function(o){console.log("\u66f4\u65b0\u5206\u6570\u6210\u529f\u56de\u8c03",o)},fail:function(o){console.error(o)}})},WeChat.onSearchScore=function(o){wx.cloud.callFunction({name:"score",data:{_type:"search",userinfo:G.userInfo},success:function(t){console.log("\u83b7\u53d6\u7528\u6237\u5206\u6570\u6210\u529f\u56de\u8c03",t),o&&o(t.result)},fail:function(t){console.error(t),o&&o(0)}})},cc._RF.pop()},{}],block:[function(o,t,e){"use strict";cc._RF.push(t,"f9c9c8BwZVOn7BdQ4JshAC8","block");var c=function(o){return o&&o.__esModule?o:{default:o}}(o("colors"));cc.Class({extends:cc.Component,properties:{numberLabel:cc.Label},start:function(){},setNumber:function(o){0==o&&(this.numberLabel.node.active=!1),this.numberLabel.string=o,o in c.default&&(this.node.color=c.default[o])}}),cc._RF.pop()},{colors:"colors"}],colors:[function(o,t,e){"use strict";cc._RF.push(t,"c663c1zfA5B/o/Mn4bbKxRY","colors");var c=[];c[0]=cc.color(198,184,172,255),c[2]=cc.color(235,224,213,255),c[4]=cc.color(234,219,193,255),c[8]=cc.color(240,167,110,255),c[16]=cc.color(244,138,89,255),c[32]=cc.color(245,112,85,255),c[64]=cc.color(245,83,52,255),c[128]=cc.color(234,200,103,255),c[256]=cc.color(234,197,87,255),c[512]=cc.color(234,192,71,255),c[1024]=cc.color(146,208,80,255),c[2048]=cc.color(0,176,240,255),t.exports=c,cc._RF.pop()},{}],game:[function(o,t,e){"use strict";cc._RF.push(t,"fa64cqw90JBWplcPU3/6jpQ","game");var c=[2,4];cc.Class({extends:cc.Component,properties:{scoreLabel:cc.Label,score:0,maxScoreLabel:cc.Label,maxScore:0,blockPrefab:cc.Prefab,gap:20,bg:cc.Node,gameOverNode:cc.Node},start:function(){this.drawBgBlocks(),this.init(),this.addEventHandler()},drawBgBlocks:function(){this.blockSize=(cc.winSize.width-5*this.gap)/4;var o=this.gap+this.blockSize/2,t=this.blockSize;this.positions=[];for(var e=0;e<4;++e){this.positions.push([0,0,0,0]);for(var c=0;c<4;++c){var n=cc.instantiate(this.blockPrefab);n.width=this.blockSize,n.height=this.blockSize,this.bg.addChild(n),n.setPosition(cc.p(o,t)),this.positions[e][c]=cc.p(o,t),o+=this.gap+this.blockSize,n.getComponent("block").setNumber(0)}t+=this.gap+this.blockSize,o=this.gap+this.blockSize/2}},init:function(){var o=this;if(this.updateScore(0),this.blocks)for(var t=0;t<this.blocks.length;++t)for(var e=0;e<this.blocks[t].length;++e)null!=this.blocks[t][e]&&this.blocks[t][e].destroy();this.data=[],this.blocks=[];for(var c=0;c<4;++c)this.blocks.push([null,null,null,null]),this.data.push([0,0,0,0]);this.addBlock(),this.addBlock(),this.addBlock(),WeChat.onSearchScore(function(t){var e=t?t.maxScore:0;o.maxScore=e,o.maxScoreLabel.string="\u4e2a\u4eba\u6700\u9ad8\u5206\u6570\uff1a"+e})},updateScore:function(o){this.score=o,this.scoreLabel.string="\u5f53\u524d\u5206\u6570\uff1a"+o},getEmptyLocations:function(){for(var o=[],t=0;t<this.blocks.length;++t)for(var e=0;e<this.blocks[t].length;++e)null==this.blocks[t][e]&&o.push({x:t,y:e});return o},addBlock:function(){var o=this.getEmptyLocations();if(0==o.length)return!1;var t=o[Math.floor(Math.random()*o.length)],e=t.x,n=t.y,a=this.positions[e][n],i=cc.instantiate(this.blockPrefab);i.width=this.blockSize,i.height=this.blockSize,this.bg.addChild(i),i.setPosition(a);var s=c[Math.floor(Math.random()*c.length)];return i.getComponent("block").setNumber(s),this.blocks[e][n]=i,this.data[e][n]=s,!0},addEventHandler:function(){var o=this;this.bg.on("touchstart",function(t){o.startPoint=t.getLocation()}),this.bg.on("touchend",function(t){o.touchEnd(t)}),this.bg.on("touchcancel",function(t){o.touchEnd(t)})},touchEnd:function(o){this.endPoint=o.getLocation();var t=this.endPoint.sub(this.startPoint);t.mag()>50&&(Math.abs(t.x)>Math.abs(t.y)?t.x>0?this.moveRight():this.moveLeft():t.y>0?this.moveUp():this.moveDown())},checkFail:function(){for(var o=0;o<4;++o)for(var t=0;t<4;++t){var e=this.data[o][t];if(0==e)return!1;if(t>0&&this.data[o][t-1]==e)return!1;if(t<3&&this.data[o][t+1]==e)return!1;if(o>0&&this.data[o-1][t]==e)return!1;if(o<3&&this.data[o+1][t]==e)return!1}return!0},gameOver:function(){this.gameOverNode.active=!0,WeChat.onUpdateScore(this.score)},afterMove:function(o){o&&(this.updateScore(this.score+1),this.addBlock()),this.checkFail()&&this.gameOver()},doMove:function(o,t,e){var c=cc.moveTo(.1,t),n=cc.callFunc(function(){e&&e()});o.runAction(cc.sequence(c,n))},doMerge:function(o,t,e,c){o.destroy();var n=cc.scaleTo(.1,1.1),a=cc.scaleTo(.1,1),i=cc.callFunc(function(){t.getComponent("block").setNumber(e)}),s=cc.callFunc(function(){c&&c()});t.runAction(cc.sequence(n,i,a,s))},moveLeft:function(){var o=this;cc.log("move left");for(var t=!1,e=function e(c,n,a){if(0!=n&&0!=o.data[c][n])if(0==o.data[c][n-1]){var i=o.blocks[c][n],s=o.positions[c][n-1];o.blocks[c][n-1]=i,o.data[c][n-1]=o.data[c][n],o.data[c][n]=0,o.blocks[c][n]=null,o.doMove(i,s,function(){e(c,n-1,a)}),t=!0}else{if(o.data[c][n-1]!=o.data[c][n])return void(a&&a());var r=o.blocks[c][n],l=o.positions[c][n-1];o.data[c][n-1]*=2,o.data[c][n]=0,o.blocks[c][n]=null,o.doMove(r,l,function(){o.doMerge(r,o.blocks[c][n-1],o.data[c][n-1],function(){a&&a()})}),t=!0}else a&&a()},c=[],n=0;n<4;++n)for(var a=0;a<4;++a)0!=this.data[n][a]&&c.push({x:n,y:a});for(var i=0,s=0;s<c.length;++s)e(c[s].x,c[s].y,function(){++i==c.length&&o.afterMove(t)})},moveRight:function(){var o=this;cc.log("move right");for(var t=!1,e=function e(c,n,a){if(3!=n&&0!=o.data[c][n])if(0==o.data[c][n+1]){var i=o.blocks[c][n],s=o.positions[c][n+1];o.blocks[c][n+1]=i,o.data[c][n+1]=o.data[c][n],o.data[c][n]=0,o.blocks[c][n]=null,o.doMove(i,s,function(){e(c,n+1,a)}),t=!0}else{if(o.data[c][n+1]!=o.data[c][n])return void(a&&a());var r=o.blocks[c][n],l=o.positions[c][n+1];o.data[c][n+1]*=2,o.data[c][n]=0,o.blocks[c][n]=null,o.doMove(r,l,function(){o.doMerge(r,o.blocks[c][n+1],o.data[c][n+1],function(){a&&a()})}),t=!0}else a&&a()},c=[],n=0;n<4;++n)for(var a=3;a>=0;--a)0!=this.data[n][a]&&c.push({x:n,y:a});for(var i=0,s=0;s<c.length;++s)e(c[s].x,c[s].y,function(){++i==c.length&&o.afterMove(t)})},moveUp:function(){var o=this;cc.log("move up");for(var t=!1,e=function e(c,n,a){if(3!=c&&0!=o.data[c][n])if(0==o.data[c+1][n]){var i=o.blocks[c][n],s=o.positions[c+1][n];o.blocks[c+1][n]=i,o.data[c+1][n]=o.data[c][n],o.data[c][n]=0,o.blocks[c][n]=null,o.doMove(i,s,function(){e(c+1,n,a)}),t=!0}else{if(o.data[c+1][n]!=o.data[c][n])return void(a&&a());var r=o.blocks[c][n],l=o.positions[c+1][n];o.data[c+1][n]*=2,o.data[c][n]=0,o.blocks[c][n]=null,o.doMove(r,l,function(){o.doMerge(r,o.blocks[c+1][n],o.data[c+1][n],function(){a&&a()})}),t=!0}else a&&a()},c=[],n=3;n>=0;--n)for(var a=0;a<4;++a)0!=this.data[n][a]&&c.push({x:n,y:a});for(var i=0,s=0;s<c.length;++s)e(c[s].x,c[s].y,function(){++i==c.length&&o.afterMove(t)})},moveDown:function(){var o=this;cc.log("move down");for(var t=!1,e=function e(c,n,a){if(0!=c&&0!=o.data[c][n])if(0==o.data[c-1][n]){var i=o.blocks[c][n],s=o.positions[c-1][n];o.blocks[c-1][n]=i,o.data[c-1][n]=o.data[c][n],o.data[c][n]=0,o.blocks[c][n]=null,o.doMove(i,s,function(){e(c-1,n,a)}),t=!0}else{if(o.data[c-1][n]!=o.data[c][n])return void(a&&a());var r=o.blocks[c][n],l=o.positions[c-1][n];o.data[c-1][n]*=2,o.data[c][n]=0,o.blocks[c][n]=null,o.doMove(r,l,function(){o.doMerge(r,o.blocks[c-1][n],o.data[c-1][n],function(){a&&a()})}),t=!0}else a&&a()},c=[],n=0;n<4;++n)for(var a=0;a<4;++a)0!=this.data[n][a]&&c.push({x:n,y:a});for(var i=0,s=0;s<c.length;++s)e(c[s].x,c[s].y,function(){++i==c.length&&o.afterMove(t)})},restart:function(){this.init(),this.gameOverNode.active=!1}}),cc._RF.pop()},{}],login:[function(o,t,e){"use strict";cc._RF.push(t,"64218GAKaVGw76s4ogrFcsW","login"),cc.Class({extends:cc.Component,properties:{BGSprite:{default:null,type:cc.Sprite,serialzable:!0}},onLoad:function(){var o=this;cc.loader.load({url:"https://7265-release-1zxx1-1301133378.tcb.qcloud.la/gamePicture/Login.png?sign=06b408dee5710fadee566d35385061b3&t=1579426938",type:"jpg"},function(t,e){var c=new cc.SpriteFrame(e);t&&console.log("\u767b\u5f55\u80cc\u666f\u56fe\u7247",t),o.BGSprite.getComponent(cc.Sprite).spriteFrame=c}),wx.login({success:function(o){o.code&&console.log("\u767b\u5f55\u6210\u529f\uff0c\u83b7\u53d6\u5230code",o.code)}});var t=wx.createUserInfoButton({type:"text",text:"\u5f00\u59cb\u6e38\u620f",style:{left:wx.getSystemInfoSync().screenWidth/2-60,top:wx.getSystemInfoSync().screenHeight/2-60,width:120,height:40,lineHeight:40,backgroundColor:"#fb94a9",color:"#ffffff",textAlign:"center",fontSize:16,borderRadius:20}});t.show(),console.log("button",t),t.onTap(function(o){console.log(o),"getUserInfo:ok"===o.errMsg?(console.log("\u5df2\u7ecf\u6388\u6743"),WeChat.onRegisterUser(o.userInfo),t.destroy()):console.log("\u6ca1\u6709\u6388\u6743")})},start:function(){}}),cc._RF.pop()},{}]},{},["GlobalData","GlobalWeChat","block","colors","game","login"]);